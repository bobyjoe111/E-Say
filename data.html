<html>
	<head>
		<title>Your EDiary</title>
	</head>
	<body>
		<button id='back'>Back</button><br><br>
		<input id='data'><br>
		<button id='submit'>Submit</button><br>
		<div id='logs'></div>
		<script>
			function newP(text, div) {
				var para = document.createElement("p");
				var node = document.createTextNode(text);
				para.appendChild(node);
				document.getElementById(div).appendChild(para);	
			}
			function newH(text, div) {
				var para = document.createElement("h3");
				var node = document.createTextNode(text);
				para.appendChild(node);
				document.getElementById(div).appendChild(para);	
			}

			var past = document.getElementById('data');
			var submit = document.getElementById('submit');
			var back = document.getElementById('back');

			back.addEventListener("click", function() {
				window.location = 'index.html';
			})
			
			var q = window.location.search;
			q = q.slice(q.indexOf('=')+1, q.length);

			submit.addEventListener('click', function() {
				addData(past.value);
			})

			async function addData(data) {
				var d = new Date();
				var options = {
					method: 'POST',
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						id: q,
						log: data,
						date: d.getMonth()+1 + '/' + d.getDate() + '/' + d.getFullYear()
					})
				};
				fetch('/addData', options);
				getData(q);
			}
			async function getData(id) {
				var options = {
					method: 'POST',
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						id: id
					})
				};
				var response = await fetch('/getData', options);
				var data = await response.json();
				document.getElementById('logs').innerHTML = '';
				for (var i = data.logs.length - 1; i > -1; i--) {	
					newH(data.logs[i].date, 'logs');
					newP(data.logs[i].log, 'logs');
				}
			}
			getData(q);
			
		</script>
	</body>
</html>